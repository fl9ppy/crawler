<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RescueBot Control Panel</title>
    <style>
        body {
            font-family: Arial;
            background: #111;
            color: #eee;
            text-align: center;
        }

        button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 16px;
        }

        .video-feed {
            margin-top: 15px;
            border: 2px solid #444;
        }

        .servo-controls button {
            width: 50px;
        }

        input[type=range] {
            width: 200px;
        }
    </style>
</head>
<body>
    <h1>RescueBot Remote Control</h1>

    <div>
        <button onclick="sendMove('FWD')">Forward (W)</button><br>
        <button onclick="sendMove('LEFT')">Left (A)</button>
        <button onclick="sendMove('STOP')">Stop (Space)</button>
        <button onclick="sendMove('RIGHT')">Right (D)</button><br>
        <button onclick="sendMove('BACK')">Backward (S)</button>
    </div>

    <h3>Camera Pan / Tilt</h3>
    <div class="servo-controls">
        <p>
            Pan:
            <button onclick="adjustPan(-10)">‚óÄÔ∏è</button>
            <span id="panDisplay">90</span>
            <button onclick="adjustPan(10)">‚ñ∂Ô∏è</button>
        </p>
        <p>
            Tilt:
            <button onclick="adjustTilt(-10)">üîº</button>
            <span id="tiltDisplay">90</span>
            <button onclick="adjustTilt(10)">üîΩ</button>
        </p>
    </div>

    <h3>Live Camera Feed</h3>
    <img src="/video_feed" class="video-feed" width="640" height="480">

    <h3>Distance Sensor</h3>
    <p id="distance">Loading...</p>

    <p style="margin-top: 20px;">
        Use <strong>W/A/S/D</strong> to move, <strong>Space</strong> to stop.
    </p>

    <script>
        let pan = 90;
        let tilt = 90;

        function sendMove(direction) {
            fetch("/move", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: "direction=" + direction
            });
        }

        function sendServo() {
            fetch("/camera", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `pan=${pan}&tilt=${tilt}`
            });

            document.getElementById("panDisplay").textContent = pan;
            document.getElementById("tiltDisplay").textContent = tilt;
        }

        function adjustPan(amount) {
            pan = Math.max(0, Math.min(180, pan + amount));
            sendServo();
        }

        function adjustTilt(amount) {
            tilt = Math.max(0, Math.min(180, tilt + amount));
            sendServo();
        }

        function updateDistance() {
            fetch("/distance")
                .then(res => res.json())
                .then(data => {
                    document.getElementById("distance").textContent = `${data.distance_cm.toFixed(1)} cm`;
                });
        }

        setInterval(updateDistance, 1000);

        document.addEventListener("keydown", function (event) {
            switch (event.key.toLowerCase()) {
                case "w":
                    sendMove("FWD");
                    break;
                case "s":
                    sendMove("BACK");
                    break;
                case "a":
                    sendMove("LEFT");
                    break;
                case "d":
                    sendMove("RIGHT");
                    break;
                case " ":
                    sendMove("STOP");
                    break;
            }
        });
    </script>
</body>
</html>

